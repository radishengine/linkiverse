define(['require'], function(require) {

  'use strict';
  
  function noteFreq(note) {
    return (440 / 32) * Math.pow(2, ((note - 9) / 12));
  }
  
  var littleEndianMode = (function() {
    var n = new Uint8Array([1, 0]);
    return new Uint16Array(n.buffer, n.byteOffset, 1)[0] === 1;
  })();
  
  function Note(audioContext, audioBuffer) {
    this.audioContext = audioContext;
    this.audioBuffer = audioBuffer;
  }
  Note.prototype = {
    createSourceNode: function(destination, baseTime, startTime, endTime, velocity) {
      if (isNaN(velocity)) velocity = 1;
      if (velocity <= 0) return;
      var node = this.audioContext.createBufferSource();
      node.buffer = this.audioBuffer;
      if (this.loop) {
        node.loop = true;
        if (!isNaN(this.loop.start)) node.loopStart = this.loop.start / this.audioBuffer.sampleRate;
        if (!isNaN(this.loop.end)) node.loopEnd = this.loop.end / this.audioBuffer.sampleRate;
      }
      node.playbackRate.value = noteFreq(this.note) / noteFreq(this.unityNote);
      node.detune.value = this.detune;
      node.start(baseTime + startTime);
      var gain = this.audioContext.createGain();
      gain.gain.value = velocity * this.gain;
      if (node.loop) {
        node.stop(baseTime + endTime);
        var fadeStart = endTime - 0.1;
        if (fadeStart > startTime) {
          gain.gain.setValueAtTime(gain.gain.value, baseTime + fadeStart);
        }
        gain.gain.exponentialRampToValueAtTime(1e-4, baseTime + endTime);
      }
      gain.connect(destination);
      node.addEventListener('ended', gain.disconnect.bind(gain));
      node.connect(gain);
    },
    note: 69,
    unityNote: 69,
    loop: null,
    detune: 0,
    gain: 1,
  };
  
  function loadNoteData(number) {
    return fetch(require.toUrl('./note'+number+'.wav'), {cache:'force-cache'})
    .then(function(req) {
      return req.arrayBuffer();
    })
    .then(function(data) {
      var samples = new Float32Array((data.byteLength - 44) / 2);
      if (littleEndianMode) {
        var samples16 = new Int16Array(data, 44, samples.length);
        for (var i = 0; i < samples.length; i++) {
          samples[i] = samples16[i] / 32768;
        }
      }
      else {
        var dv = new DataView(data);
        for (var i = 0; i < samples.length; i++) {
          samples[i] = dv.getInt16(44 + i * 2, true) / 32768;
        }
      }
      return samples;
    });
  }
  
  var note = {
    load: function(audioContext, program, bank) {
      var noteNumber, parts;
      switch (program) {
        case 0x00: default:
          noteNumber = 1;
          switch (bank) {
            case 0x00: default:
              parts = [
                [38, 13672, 36, 11989, 1682, -11.3, -4],
                [43, 13103, 41, 10830, 2272, -9.98, -1],
                [50, 11168, 48, 9313, 1854, -12.3, 0],
                [59, 9797, 56, 8309, 1487, -9.8, 0],
                [67, 10516, 64, 9176, 1139, -6.7, 1],
                [74, 7588, 73, 6194, 1393, -7.2, 1],
                [81, 7669, 78, 6447, 1221, -7.7, -1],
                [88, 7345, 84, 5976, 1368, -7.2, -2],
                [97, 6442, 92, 5392, 1049, -8.2, 1],
                [127, 4842, 103, 4686, 155, -9.425, 3],
              ];
              break;
            case 0x10:
              // bank 0x00 with +/- attenuation, key ranges
              parts = [
                [32, 13672, 36, 11989, 1682, -10.13, -4],
                [37, 13103, 41, 10830, 2272, -9.71, -1],
                [44, 11168, 48, 9313, 1854, -10.13, 0],
                [53, 9797, 56, 8309, 1487, -10.13, 0],
                [61, 10516, 64, 9176, 1139, -10.13, 1],
                [68, 7588, 73, 6194, 1393, -8.2, 1],
                [75, 7669, 78, 6447, 1221, -8.7, -1],
                [82, 7345, 84, 5976, 1368, -9.15, -2],
                [96, 6442, 92, 5392, 1049, -9.1, 1],
                [127, 4842, 103, 4686, 155, -9.1, 3],
              ];
              break;
          }
          break;
        case 0x01:
          // program 0x00 with +/- attenuation, key ranges
          noteNumber = 1;
          parts = [
            [41, 13672, 36, 11989, 1682, -9.01, -4],
            [46, 13103, 41, 10830, 2272, -8.58, -1],
            [53, 11168, 48, 9313, 1854, -9.01, 0],
            [62, 9797, 56, 8309, 1487, -8.7, 0],
            [70, 10516, 64, 9176, 1139, -8.7, 1],
            [77, 7588, 73, 6194, 1393, -7.2, 1],
            [84, 7669, 78, 6447, 1221, -8.2, -1],
            [91, 7345, 84, 5976, 1368, -8.03, -2],
            [100, 6442, 92, 5392, 1049, -8.03, 1],
            [127, 4842, 103, 4686, 155, -8.03, 3],
          ];
          break;
        case 0x02:
          // program 0x00 with +/- attenuation, key ranges
          noteNumber = 1;
          parts = [
            [45, 13672, 36, 11989, 1682, -6.03, -4],
            [50, 13103, 41, 10830, 2272, -5.6, -1],
            [57, 11168, 48, 9313, 1854, -6.03, 0],
            [66, 9797, 56, 8309, 1487, -6.03, 0],
            [74, 10516, 64, 9176, 1139, -6.03, 1],
            [81, 7588, 73, 6194, 1393, -5.04, 1],
            [88, 7669, 78, 6447, 1221, -5.74, -1],
            [95, 7345, 84, 5976, 1368, -5.04, -2],
            [104, 6442, 92, 5392, 1049, -5.04, 1],
            [127, 4842, 103, 4686, 155, -5.04, 3],
          ];
          break;
        case 0x03:
          noteNumber = 2;
          parts = [
            [49, 5996, 42, 5284, 711, -9.02, -10],
            [67, 2924, 62, 2699, 224, -5.04, -10],
            [78, 2938, 71, 2848, 89, -5.04, -6],
            [90, 2607, 84, 2585, 21, -5.04, -6],
            [127, 2004, 96, 1802, 201, -5.04, 7],
          ];
          break;
        case 0x04:
          switch (bank) {
            case 0x00: default:
              noteNumber = 3;
              parts = [
                [46, 961, 49, 800, 160, -4.5, 10],
                [66, 839, 56, 731, 107, -4.5, 13],
                [80, 418, 67, 361, 56, -4.5, -8],
                [101, 496, 80, 442, 53, -4.5, -3],
                [127, 115, 97, 104, 10, -8.2, 10],
              ];
              break;
            case 0x08:
              noteNumber = 4;
              parts = [
                [47, 6934, 60, 6178, 755, -4.15, -8],
                [72, -6934, 60, 6178, 755, -7.13, -8],
                [103, 2218, 84, 2112, 105, -4.2, -6],
                [127, -2218, 84, 2112, 105, -6.2, -6],
              ];
              break;
            case 0x10:
              // 0x00 with minor changes to attenuation & key ranges
              noteNumber = 3;
              parts = [
                [46, 961, 49, 800, 160, -5.6, 10],
                [66, 839, 56, 731, 107, -5.6, 13],
                [80, 418, 67, 361, 56, -5.6, -8],
                [93, 496, 80, 442, 53, -5.6, -3],
                [127, 115, 97, 104, 10, -5.6, 10],
              ];
              break;
            case 0x18:
              noteNumber = 5;
              parts = [
                [45, 1096, 48, 927, 168, -6.88, -6],
                [53, 655, 53, 402, 252, -6.2, -4],
                [63, 1044, 64, 909, 134, -6.2, 3],
                [75, 1041, 70, 946, 94, -6.2, -11],
                [83, 1004, 83, 936, 67, -6.2, 1],
                [91, 958, 87, 904, 53, -7.5, -5],
                [127, 771, 93, 695, 75, -8.2, -4],
              ];
              break;
          }
          break;
        case 0x05:
          switch (bank) {
            case 0x00: default:
              noteNumber = 6;
              parts = [
                [60, 2004, 48, 1835, 168, -9.56, -6],
                [68, 1313, 56, 1206, 106, -9.56, -3],
                [76, 965, 64, 897, 67, -8.07, 3],
                [84, 544, 72, 501, 42, -8, -6],
                [92, 405, 80, 351, 53, -9, -3],
                [100, 354, 88, 303, 50, -11, -6],
                [127, 286, 96, 190, 95, -12.4, 3],
              ];
              break;
            case 0x08:
              noteNumber = 7;
              parts = [
                [83, 5048, 78, 1365, 3682, -9.3, -6],
                [95, -5048, 78, 1365, 3682, -13.3, -6],
                [127, -5048, 78, 1365, 3682, -16.3, -6],
              ];
              break;
            case 0x10:
              // same as 0x00 with some attenuation differences
              noteNumber = 6;
              parts = [
                [60, 2004, 48, 1835, 168, -10.2, -6],
                [68, 1313, 56, 1206, 106, -10.2, -3],
                [76, 965, 64, 897, 67, -8.72, 3],
                [84, 544, 72, 501, 42, -8.03, -6],
                [92, 405, 80, 351, 53, -8.03, -3],
                [100, 354, 88, 303, 50, -9, -6],
                [127, 286, 96, 190, 95, -10, 3],
              ];
              break;
          }
          break;
        case 0x06:
          noteNumber = 8;
          switch (bank) {
            case 0x00: default:
              parts = [
                [54, 6687, 48, 5506, 1180, -7.62, 0],
                [66, 5176, 60, 4501, 674, -7.62, -1],
                [80, 4008, 72, 3291, 716, -7.62, -1],
                [100, 3666, 87, 3169, 496, -8.6, 0],
                [127, -3666, 87, 3169, 496, -9.6, 0],
              ];
              break;
            case 0x08:
              // same as 0x00 with attenuation and key range differences
              parts = [
                [51, 6687, 48, 5506, 1180, -9.62, 0],
                [63, 5176, 60, 4501, 674, -9.62, -1],
                [77, 4008, 72, 3291, 716, -9.62, -1],
                [97, 3666, 87, 3169, 496, -9.62, 0],
                [127, -3666, 87, 3169, 496, -9.62, 0],
              ];
              break;
            case 0x10:
              // same as 0x00 with attenuation differences
              parts = [
                [54, 6687, 48, 5506, 1180, -7.12, 0],
                [66, 5176, 60, 4501, 674, -7.12, -1],
                [80, 4008, 72, 3291, 716, -7.12, -1],
                [100, 3666, 87, 3169, 496, -8.1, 0],
                [127, -3666, 87, 3169, 496, -9.1, 0],
              ];
              break;
            case 0x18:
              // same as 0x00 with attenuation and key range differences
              parts = [
                [54, 6687, 48, 5506, 1180, -10.35, 0],
                [66, 5176, 60, 4501, 674, -10.35, -1],
                [80, 4008, 72, 3291, 716, -10.35, -1],
                [100, 3666, 87, 3169, 496, -11.3, 0],
                [127, -3666, 87, 3169, 496, -12.3, 0],
              ];
              break;
          }
          break;
        case 0x07:
          noteNumber = 9;
          parts = [
            1630,
            [46, 636, 48, 467, 168, -5.58, -6],
            [65, 375, 60, 290, 84, -4.57, -6],
            [78, 249, 72, 206, 42, -4.15, -6],
            [95, 98, 84, 76, 21, -6.2, -6],
            1523,
            [127, 227, 103, 212, 14, -11, -8],
          ];
          break;
        case 0x08:
          noteNumber = 9;
          parts = [
            1630 + 636 + 375 + 249 + 98 + 1523 + 227,
            [98, 545, 77, 292, 252, -4.2, -4],
            797,
            [102, 144, 101, 81, 62, -5.1, -32],
            1085 + 595 + 5466 + 3196 + 1912 + 1603,
            [127, 315, 90, 299, 15, -5, 12],
          ];
          break;
        case 0x09:
          noteNumber = 10;
          parts = [
            [87, 445, 85, 326, 118, -0.3, -19],
            [91, 317, 91, 232, 84, -5.9, -8],
            [127, 170, 102, 125, 44, -6.7, -27],
          ];
          break;
        case 0x0A:
          noteNumber = 9;
          parts = [
            1630 + 636 + 375 + 249 + 98 + 1523 + 227 + 545,
            [57, 797, 82, 583, 213, -2.5, 1],
            [88, -797, 82, 583, 213, -4.2, 1],
            [102, 144, 101, 81, 62, -3.1, -32],
            1085 + 595 + 5466 + 3196 + 1912 + 1603,
            [127, 315, 90, 299, 15, -5, 12],
          ];
          break;
        case 0x0B:
          noteNumber = 11;
          parts = [
            [57, 6548, 52, 5878, 669, -3, 0],
            [70, 5973, 64, 5704, 268, -4, 3],
            [82, 3536, 76, 3300, 235, -6.03, 6],
            [93, 2383, 88, 2264, 118, -4.15, 14],
            [127, 2488, 100, 2428, 59, -8.2, 14],
          ];
          break;
        case 0x0C:
          noteNumber = 9;
          parts = [
            1630 + 636 + 375 + 249 + 98 + 1523 + 227 + 545 + 797 + 144 + 1085 + 595 + 5466 + 3196,
            [48, 1912, 54, 1317, 594, -6.62, -6],
            [81, 1603, 62, 1528, 74, -6.9, -25],
            [127, 315, 90, 299, 15, -5, 12],
          ];
          break;
        case 0x0D:
          noteNumber = 9;
          parts = [
            1630 + 636 + 375 + 249 + 98 + 1523 + 227 + 545 + 797 + 144,
            [88, 1085, 72, 959, 125, -0.91, -20],
            [101, 595, 93, 545, 49, 0, -39],
            5466 + 3196 + 1912 + 1603,
            [127, 315, 90, 299, 15, -9, 12],
          ];
          break;
        case 0x0E:
          noteNumber = 10;
          switch (bank) {
            case 0x00: default:
              parts = [
                445 + 317 + 170,
                [89, 1167, 84, 294, 872, -7.2, -5],
                [96, -1167, 84, 294, 872, -10, -5],
                [127, -1167, 84, 294, 872, -13, -5],
              ];
              break;
            case 0x08:
              // same as 0 with different attenuation
              parts = [
                445 + 317 + 170,
                [89, 1167, 84, 294, 872, -8.1, -5],
                [96, -1167, 84, 294, 872, -11, -5],
                [127, -1167, 84, 294, 872, -16, -5],
              ];
              break;
            case 0x09:
              // same as 0 with different attenuation
              parts = [
                445 + 317 + 170,
                [89, 1167, 84, 294, 872, -7.6, -5],
                [96, -1167, 84, 294, 872, -15, -5],
                [127, -1167, 84, 294, 872, -20, -5],
              ];
              break;
          }
          break;
        case 0x0F:
          noteNumber = 9;
          parts = [
            1630 + 636 + 375 + 249 + 98,
            [55, 1523, 74, 1112, 410, 0, -13],
            [87, -1523, 74, 1112, 410, -4.5, -13],
            [127, 227, 103, 212, 14, -7.2, -8],
          ];
          break;
        case 0x10:
          switch (bank) {
            case 0x00: default:
              noteNumber = 10;
              parts = [
                445 + 317 + 170 + 1167,
                [79, 545, 73, 465, 79, -5.6, -12],
                [92, 277, 85, 236, 40, -9.5, 10],
                [127, 145, 97, 124, 20, -11.5, 10],
              ];
              break;
            case 0x08:
              noteNumber = 12;
              parts = [
                [64, 4669, 90, 903, 3766, -2.5, -2],
                [127, -4669, 90, 903, 3766, -5.47, -2],
              ];
              break;
            case 0x10:
              noteNumber = 10;
              parts = [
                445 + 317 + 170 + 1167 + 545 + 277 + 145,
                [55, 244, 67, 187, 56, -4.8, -8],
                [84, -244, 67, 187, 56, -7.5, -8],
                [93, 101, 91, 86, 14, -4.8, -8],
                [96, 98, 97, 87, 10, -4.8, 10],
                [127, -98, 97, 87, 10, -9.2, 10],
              ];
              break;
            case 0x20:
              // 0 with different attenuation
              noteNumber = 10;
              parts = [
                445 + 317 + 170 + 1167,
                [79, 545, 73, 465, 79, -5.3, -12],
                [92, 277, 85, 236, 40, -5.7, 10],
                [127, 145, 97, 124, 20, -6, 10],
              ];
              break;
          }
          break;
        case 0x11:
          switch (bank) {
            case 0x00: default:
              noteNumber = 13;
              parts = [
                [64, 3936, 53, 3682, 253, -1.8, 3],
                [82, 1771, 68, 1663, 107, -1.3, 13],
                [127, 1416, 86, 1340, 75, -3.3, -2],
              ];
              break;
            case 0x08:
              // 0 with different attenuation (including an additional key range)
              noteNumber = 13;
              parts = [
                [64, 3936, 53, 3682, 253, 0, 3],
                [82, 1771, 68, 1663, 107, 0, 13],
                [94, 1416, 86, 1340, 75, -4.5, -2],
                [127, -1416, 86, 1340, 75, -8.3, -2],
              ];
              break;
            case 0x20:
              // 0x10 bank 0 with different attenuation and key range
              noteNumber = 10;
              parts = [
                445 + 317 + 170 + 1167,
                [76, 545, 73, 465, 79, -0.7, -12],
                [92, 277, 85, 236, 40, -1.11, 10],
                [127, 145, 97, 124, 20, -1.4, 10],
              ];
              break;              
          }
          break;
        case 0x12:
          noteNumber = 14;
          parts = [
            [55, 3498, 71, 1236, 2261, -3.6, 22],
            [69, 3671, 83, 1353, 2317, -2.14, -3],
            [127, 3445, 95, 1260, 2184, -2.14, -3],
          ];
          break;
        case 0x13:
          noteNumber = 15;
          switch (bank) {
            case 0x00: default:
              parts = [
                [52, 2125, 46, 1752, 372, -10.53, -30],
                [60, 1542, 56, 914, 627, -10.53, -28],
                [73, 829, 66, 593, 235, -10.5, -25],
                [86, 1271, 78, 1211, 59, -10.5, -17],
                [127, 794, 90, 764, 29, -9.5, -47],
              ];
              break;
            case 0x08: // 0 with +/- attenuation
              parts = [
                [52, 2125, 46, 1752, 372, -9.9, -30],
                [60, 1542, 56, 914, 627, -9.9, -28],
                [73, 829, 66, 593, 235, -9.9, -25],
                [86, 1271, 78, 1211, 59, -9.9, -17],
                [127, 794, 90, 764, 29, -9.9, -47],
              ];
              break;
            case 0x10: // 0 with +/- attenuation, key ranges
              parts = [
                [49, 2125, 46, 1752, 372, -10.53, -30],
                [57, 1542, 56, 914, 627, -10.53, -28],
                [69, 829, 66, 593, 235, -10.5, -25],
                [86, 1271, 78, 1211, 59, -10.5, -17],
                [127, 794, 90, 764, 29, -9.5, -47],
              ];
              break;
          }
          break;
        case 0x14:
          noteNumber = 16;
          parts = [
            791 + 589,
            [46, 296, 53, 41, 254, -8.2, 10],
            [68, -296, 53, 41, 254, -10.6, 10],
            [83, 56, 72, 12, 43, -5.4, 35],
            [92, -56, 72, 12, 43, -7.4, 35],
            [127, 101, 88, 50, 50, -8, -6],
          ];
          break;
        case 0x15:
          noteNumber = 17;
          switch (bank) {
            case 0x00: default:
              parts = [
                [48, 3762, 68, 2752, 1009, -2.8, 0],
                [84, -3762, 68, 2752, 1009, -6.1, 0],
                [95, 2160, 96, 2075, 84, -1.4, -6],
                101,
                [127, 415, 95, 403, 11, -4, -25],
              ];
              break;
            case 0x08:
              parts = [
                [48, 3762, 68, 2752, 1009, -4.24, 0],
                [84, -3762, 68, 2752, 1009, -7.5, 0],
                [95, 2160, 96, 2075, 84, -2.8, -6],
                [127, 101, 88, 50, 50, -5, -6],
              ];
              break;
          }
          break;
        case 0x16:
          noteNumber = 16;
          parts = [
            791 + 589 + 296 + 56 + 101,
            [68, 109, 56, 2, 106, -7.9, -3],
            [76, 69, 64, 1, 67, -7.17, 3],
            [84, 46, 72, 3, 42, -6.475, -6],
            [92, 56, 80, 2, 53, -6.2, -3],
            [101, 52, 88, 1, 50, -6.2, -6],
            [127, 23, 96, 1, 21, -6.3, -6],
          ];
          break;
        case 0x17:
          noteNumber = 16;
          parts = [
            [44, 791, 64, 723, 67, -2.5, 3],
            [71, -791, 64, 723, 67, -4.7, 3],
            [82, 589, 74, 512, 76, -5, 21],
            296,
            [95, 56, 72, 12, 43, -5.4, 35],
            [127, 101, 88, 50, 50, -5, -6],
          ];
          break;
        case 0x18:
          noteNumber = 18;
          switch (bank) {
            case 0x00: default:
              parts = [
                1410 + 1075 + 511,
                [52, 4472, 48, 3460, 1011, -4.57, -1],
                [66, 4168, 57, 3565, 602, -4.57, 2],
                [76, 3341, 70, 2820, 520, -4.15, -1],
                [89, 2901, 79, 2787, 113, -4.15, 8],
                [91, 1812, 88, 1727, 84, -5.43, 8],
                [99, 1089, 97, 1008, 80, -6.3, 10],
                3322,
                [127, 2491, 101, 1843, 647, -9.8, 0],
              ];
              break;
            case 0x08:
              parts = [
                1410 + 1075 + 511,
                [44, 4472, 48, 3460, 1011, -6.57, -1],
                [58, 4168, 57, 3565, 602, -6.57, 2],
                [68, 3341, 70, 2820, 520, -6.15, -1],
                [81, 2901, 79, 2787, 113, -6.15, 8],
                [83, 1812, 88, 1727, 84, -7.42, 8],
                [92, 1089, 97, 1008, 80, -8.34, 10],
                [127, 3322, 104, 3308, 13, -7.88, -36],
              ];
              break;
            case 0x10:
              // case 0 with +/- attenuation
              parts = [
                1410 + 1075 + 511,
                [52, 4472, 48, 3460, 1011, -3.72, -1],
                [66, 4168, 57, 3565, 602, -3.72, 2],
                [76, 3341, 70, 2820, 520, -3.3, -1],
                [89, 2901, 79, 2787, 113, -3.3, 8],
                [91, 1812, 88, 1727, 84, -4.58, 8],
                [99, 1089, 97, 1008, 80, -5.5, 10],
                3322,
                [127, 2491, 101, 1843, 647, -9.8, 0],
              ];
              break;
            case 0x20:
              parts = [
                1410 + 1075 + 511,
                [52, 4472, 48, 3460, 1011, -2.73, -1],
                [66, 4168, 57, 3565, 602, -2.73, 2],
                [76, 3341, 70, 2820, 520, -2.32, -1],
                [89, 2901, 79, 2787, 113, -2.32, 8],
                [91, 1812, 88, 1727, 84, -3.59, 8],
                [99, 1089, 97, 1008, 80, -4.5, 10],
                3322,
                [127, 2491, 101, 1843, 647, -9.3, 0],
              ];
              break;
          }
          break;
        case 0x19:
          noteNumber = 19;
          switch (bank) {
            case 0x00: default:
              parts = [
                [44, 9361, 41, 8352, 1008, -4.3, -4],
                [52, 5905, 49, 4790, 1114, -4.3, 0],
                [60, 5026, 57, 4724, 301, -4.3, 2],
                [69, 5140, 65, 4886, 253, -3.3, 3],
                [81, 3785, 74, 3596, 188, -3.3, 3],
                [88, 2954, 84, 2763, 190, -5.7, 3],
                [127, -2954, 84, 2763, 190, -8, 3],
              ];
              break;
            case 0x08:
              parts = [
                9361,
                [47, 5905, 49, 4790, 1114, -6.5, 0],
                5026 + 5140 + 3785 + 2954,
                [69, 6012, 55, 5448, 563, -7.7, 2],
                [86, 3125, 79, 2337, 787, -5, -1],
                [127, 2410, 89, 1827, 582, -5.47, -6],
              ];
              break;
            case 0x10:
              parts = [
                [36, 9361, 41, 8352, 1008, -2.7, -4],
                [44, 5905, 49, 4790, 1114, -2.7, 0],
                [52, 5026, 57, 4724, 301, -2.7, 2],
                [61, 5140, 65, 4886, 253, -1.72, 3],
                [73, 3785, 74, 3596, 188, -1.72, 3],
                [127, 2954, 84, 2763, 190, -3.45, 3],
              ];
              break;
          }
          break;
        case 0x1A:
          noteNumber = 20;
          switch (bank) {
            case 0x00: default:
              parts = [
                [54, 6485, 50, 4982, 1502, -1.72, 0],
                [63, 6394, 59, 4518, 1875, -1.72, 0],
                [71, 5460, 68, 4663, 796, -1.72, -1],
                [79, 4422, 74, 3895, 526, -1.72, 1],
                [88, 4989, 84, 4102, 886, -3.44, 2],
                [97, 3560, 93, 2882, 677, -5.2, 1],
                [127, 2491, 101, 1843, 647, -6.2, 0],
              ];
              break;
            case 0x08:
              // case 0 with +/- attenuation, key ranges
              parts = [
                [66, 6485, 50, 4982, 1502, -7.71, 0],
                [75, 6394, 59, 4518, 1875, -7.71, 0],
                [83, 5460, 68, 4663, 796, -7.71, -1],
                [91, 4422, 74, 3895, 526, -7.71, 1],
                [100, 4989, 84, 4102, 886, -9.43, 2],
                [109, 3560, 93, 2882, 677, -10.6, 1],
                [127, 2491, 101, 1843, 647, -11, 0],
              ];
              break;
          }
          break;
        case 0x1B:
          noteNumber = 21;
          switch (bank) {
            case 0x00: default:
              parts = [
                [54, 5025, 48, 4686, 338, -4.48, 4],
                [62, 3771, 60, 3433, 337, -4.8, -1],
                [70, 3104, 67, 2877, 226, -4.8, 8],
                [80, 2351, 72, 2013, 337, -4.48, -1],
                [99, 2286, 83, 2263, 22, -4.5, -25],
                [127, 2954, 84, 2763, 190, -8.7, 3],
              ];
              break;
            case 0x08:
              // case 0 with +/i attenuation, key ranges
              parts = [
                [54, 5025, 48, 4686, 338, -5.1, 4],
                [63, 3771, 60, 3433, 337, -6.1, -1],
                [70, 3104, 67, 2877, 226, -8.82, 8],
                [80, 2351, 72, 2013, 337, -8.54, -1],
                [99, 2286, 83, 2263, 22, -8.5, -25],
                [127, 2954, 84, 2763, 190, -8.7, 3],
              ];
              break;
          }
          break;
        case 0x1C:
          noteNumber = 18;
          switch (bank) {
            case 0x00: default:
              parts = [
                [69, 1410, 43, 1184, 225, -4.1, 0],
                [72, 1075, 64, 1007, 67, -3.3, 3],
                [86, 511, 81, 485, 25, -3.3, -4],
                4472 + 4168 + 3341 + 2901,
                [91, 1812, 88, 1727, 84, -5.4, 8],
                [99, 1089, 97, 1008, 80, -6.3, 10],
                3322,
                [127, 2491, 101, 1843, 647, -9.2, 0],
              ];
              break;
            case 0x08:
              // case 0 with +/- attenuation and key ranges
              parts = [
                [56, 1410, 43, 1184, 225, -7.3, 0],
                [68, 1075, 64, 1007, 67, -4.8, 3],
                [86, 511, 81, 485, 25, -4.8, -4],
                4472 + 4168 + 3341 + 2901,
                [91, 1812, 88, 1727, 84, -4.8, 8],
                [99, 1089, 97, 1008, 80, -5.7, 10],
                3322,
                [127, 2491, 101, 1843, 647, -8.6, 0],
              ];
              break;
            case 0x10:
              // case 0 with +/- attenuation
              parts = [
                [69, 1410, 43, 1184, 225, -6.8, 0],
                [72, 1075, 64, 1007, 67, -5.3, 3],
                [86, 511, 81, 485, 25, -5.3, -4],
                4472 + 4168 + 3341 + 2901,
                [91, 1812, 88, 1727, 84, -4.4, 8],
                [99, 1089, 97, 1008, 80, -5.3, 10],
                3322,
                [127, 2491, 101, 1843, 647, -8.2, 0],
              ];
              break;
          }
          break;
        case 0x1D:
          noteNumber = 22;
          parts = [
            [44, 4760, 32, 4335, 424, -6.5, -3],
            [49, 3904, 37, 3585, 318, -5.7, -1],
            [57, 2603, 48, 2433, 169, -4.5, 4],
            [63, 4360, 60, 4190, 169, -5.04, 4],
            [70, 1302, 59, 1213, 88, -5.04, -25],
            [73, 1334, 61, 1253, 80, -5.04, 10],
            [77, 931, 65, 867, 63, -5.04, -4],
            [89, 675, 77, 643, 31, -5.04, -32],
            [96, 400, 84, 378, 21, -5.04, -6],
            [127, 351, 94, 291, 59, -5.04, -4],
          ];
          break;
        case 0x1E:
          noteNumber = 23;
          switch (bank) {
            case 0x00: default:
              parts = [
                6133 + 3232,
                [48, 3652, 36, 3314, 337, -4.15, -1],
                [54, 3282, 42, 3044, 237, -4.42, -10],
                [59, 2270, 47, 2091, 178, -4.15, -6],
                [64, 1805, 52, 1671, 133, -4.15, -10],
                [71, 940, 59, 850, 89, -4.85, -6],
                [77, 1126, 65, 1062, 63, -4.15, -4],
                [92, 714, 80, 661, 52, -3.5, -36],
                [101, 426, 89, 394, 31, -8.7, -32],
                [127, 514, 97, 503, 10, -10.2, 10],
              ];
              break;
            case 0x08:
              // case 0 with +/- attenuation
              parts = [
                6133 + 3232,
                [48, 3652, 36, 3314, 337, -5.04, -1],
                [54, 3282, 42, 3044, 237, -5.32, -10],
                [59, 2270, 47, 2091, 178, -5.04, -6],
                [64, 1805, 52, 1671, 133, -5.04, -10],
                [71, 940, 59, 850, 89, -5.74, -6],
                [77, 1126, 65, 1062, 63, -5.04, -4],
                [92, 714, 80, 661, 52, -5.04, -36],
                [101, 426, 89, 394, 31, -8, -32],
                [127, 514, 97, 503, 10, -9, 10],
              ];
              break;
          }
          break;
        case 0x1F:
          switch (bank) {
            case 0x00: default:
              noteNumber = 10;
              parts = [
                445 + 317 + 170 + 1167 + 545 + 277 + 145 + 244 + 101 + 98,
                [64, 856, 67, 784, 71, -4.43, 27],
                [80, 710, 82, 691, 18, -0.28, 26],
                [95, -710, 82, 691, 18, -4.7, 26],
                [127, -710, 99, 691, 18, -7.8, 26], // 99 seems like a mistake here?
              ];
              break;
            case 0x08:
              noteNumber = 24;
              parts = [
                1445 + 1424 + 2472 + 687,
                [52, 234, 52, 100, 133, -6.68, -10],
                [64, 119, 64, 51, 67, -5.98, 3],
                [76, 60, 76, 25, 34, -5.98, 28],
                [88, 31, 88, 13, 17, -5.98, 28],
                [100, 30, 99, 11, 18, -5.98, 27],
                [112, 27, 109, 16, 10, -5.98, 10],
                [127, 43, 119, 17, 25, -5.98, -8],
              ];
              break;
          }
          break;
        case 0x20:
          noteNumber = 25;
          parts = [
            [37, 8241, 32, 7814, 426, -1.7, 5],
            [51, 6991, 43, 6539, 451, -0.7, 4],
            [72, 2725, 60, 2639, 85, -0.7, 15],
            [84, -2725, 60, 2639, 85, -1.7, 15],
            [86, 2760, 83, 2290, 469, -4.2, 1],
            [127, 2182, 96, 2033, 148, -6.9, 6],
          ];
          break;
        case 0x21:
          noteNumber = 26;
          parts = [
            [43, 2824, 56, 2717, 106, -3.96, -3],
            [54, 2562, 59, 2472, 89, -2.41, -6],
            [80, 1132, 76, 997, 134, -0.98, 3],
            [106, -1132, 76, 997, 134, -4.5, 3],
            [127, 30, 99, 11, 18, -11, 27],
          ];
          break;
        case 0x22:
          noteNumber = 27;
          parts = [
            [35, 7171, 30, 6692, 478, -2.42, 4],
            [45, 6837, 40, 6302, 534, -4.15, -4],
            [78, 3699, 50, 3397, 301, -4.15, 4],
            9646 + 5514 + 2581,
            [88, 4989, 84, 4102, 886, -6.1, 2],
            [97, 3560, 93, 2882, 677, -6.9, 1],
            [127, 2491, 101, 1843, 647, -6.9, 0],
          ];
          break;
        case 0x23:
          noteNumber = 27;
          parts = [
            7171 + 6837 + 3699,
            [42, 9646, 36, 9308, 337, -3.2, -1],
            [66, 5514, 48, 5344, 169, -3.2, 4],
            [78, 2581, 60, 2496, 84, -5.2, -6],
            [88, 4989, 84, 4102, 886, -8.3, 2],
            [97, 3560, 93, 2882, 677, -9.1, 1],
            [127, 2491, 101, 1843, 647, -9.1, 0],
          ];
          break;
        case 0x24:
          noteNumber = 28;
          parts = [
            1798,
            [38, 7419, 31, 6513, 905, -2, 10],
            [67, 5488, 43, 3908, 1579, 0, 4],
            [104, 351, 83, 328, 22, 0, -25],
            9903 + 3109 + 2999,
            [127, 2954, 84, 2763, 190, -10.7, 3],
          ];
          break;
        case 0x25:
          noteNumber = 28;
          parts = [
            [50, 1798, 52, 1260, 537, -3.14, 6],
            [60, -1798, 52, 1260, 537, -5.98, 6],
            7419,
            [69, 5488, 43, 3908, 1579, 0, 4],
            [104, 351, 83, 328, 22, 0, -25],
            9903 + 3109 + 2999,
            [127, 2954, 84, 2763, 190, -10.7, 3],
          ];
          break;
        case 0x26:
          switch (bank) {
            case 0x00: default:
              noteNumber = 29;
              parts = [
                8964 + 6101,
                [45, 16880, 33, 16476, 403, -3.35, 9],
                [69, 3646, 48, 3475, 170, -2.66, 15],
                [90, 2488, 72, 2445, 42, -2.66, -6],
                [127, 1378, 96, 1356, 21, -2.66, -6],
              ];
              break;
            case 0x01:
              noteNumber = 24;
              parts = [
                [34, 1445, 59, 1353, 91, -0.76, 33],
                [46, -1445, 59, 1353, 91, -3.74, 33],
                [127, 1424, 72, 1380, 43, -6.2, 35],
              ];
              break;
            case 0x08:
              noteNumber = 29;
              parts = [
                [54, 8964, 36, 8625, 338, -2.5, 4],
                6101 + 16880,
                [69, 3646, 48, 3475, 170, -2.5, 15],
                [90, 2488, 72, 2445, 42, -2.5, -6],
                [127, 1378, 96, 1356, 21, -2.5, -6],
              ];
              break;
          }
          break;
        case 0x27:
          switch (bank) {
            case 0x00: default:
              noteNumber = 28;
              parts = [
                1798 + 7419 + 5488 + 351,
                [43, 9903, 33, 9501, 401, -2.58, 0],
                [66, 3109, 48, 2768, 340, -2.58, 15],
                [83, 2999, 72, 2956, 42, -3.6, -6],
                [96, -2999, 72, 2956, 42, -5.4, -6],
                [127, 2954, 84, 2763, 190, -6.3, 3],
              ];
              break;
            case 0x08:
              noteNumber = 29;
              parts = [
                8964,
                [45, 6101, 29, 5591, 509, -3.8, 13],
                16880,
                [69, 3646, 48, 3475, 170, -2.5, 15],
                [90, 2488, 72, 2445, 42, -2.5, -6],
                [127, 1378, 96, 1356, 21, -2.5, -6],
              ];
              break;
            case 0x10:
              noteNumber = 24;
              parts = [
                [34, 1445, 59, 1353, 91, -3.19, 33],
                [46, -1445, 59, 1353, 91, -6.17, 33],
                [60, 1424, 72, 1380, 43, -6.7, 35],
                [72, -1424, 72, 1380, 43, -9.7, 35],
                [84, -1424, 72, 1380, 43, -10.7, 35],
                [96, -1424, 72, 1380, 43, -13.7, 35],
                [127, -1424, 72, 1380, 43, -16.7, 35],
              ];
              break;
          }
          break;
        case 0x28:
          noteNumber = 30;
          switch (bank) {
            case 0x00: default:
              parts = [
                1783 + 1067 + 1105 + 797 + 487,
                [68, 1448, 56, 1341, 106, -7.45, -3],
                [70, 1579, 58, 1483, 95, -6.71, 7],
                [76, 1398, 64, 1330, 67, -6.13, 3],
                [80, 1352, 68, 1298, 53, -7.45, -3],
                [88, 1153, 74, 1115, 37, -5.6, -25],
                [96, 957, 83, 934, 22, -6.3, -25],
                [105, 922, 92, 868, 53, -5.6, -3],
                [106, 19, 106, 6, 12, -5.6, 25],
                [127, 411, 95, 366, 44, -7.3, -25],
              ];
              break;
            case 0x08:
              parts = [
                1783,
                [57, 1067, 41, 813, 253, -4.72, 3],
                1105 + 797 + 487,
                [68, 1448, 56, 1341, 106, -6.6, -3],
                [70, 1579, 58, 1483, 95, -5.86, 7],
                [76, 1398, 64, 1330, 67, -5.29, 3],
                [80, 1352, 68, 1298, 53, -6.6, -3],
                [88, 1153, 74, 1115, 37, -4.7, -25],
                [96, 957, 83, 934, 22, -5.4, -25],
                [105, 922, 92, 868, 53, -4.7, -3],
                [106, 19, 106, 6, 12, -4.7, 25],
                [127, 411, 95, 366, 44, -7.3, -25],
              ];
              break;
          }
          break;
        case 0x29:
          noteNumber = 30;
          // 0x28 bank 0 with +/- attenuation, key ranges
          parts = [
            1783 + 1067 + 1105 + 797 + 487,
            [60, 1448, 56, 1341, 106, -5.88, -3],
            [62, 1579, 58, 1483, 95, -5.13, 7],
            [68, 1398, 64, 1330, 67, -4.56, 3],
            [72, 1352, 68, 1298, 53, -5.88, -3],
            [78, 1153, 74, 1115, 37, -4, -25],
            [84, 957, 83, 934, 22, -4.7, -25],
            [105, 922, 92, 868, 53, -4, -3],
            [106, 19, 106, 6, 12, -4, 25],
            [127, 411, 95, 366, 44, -6.8, -25],
          ];
          break;
        case 0x2A:
          noteNumber = 30;
          parts = [
            [33, 1783, 28, 1251, 531, -5.58, -13],
            [45, 1067, 41, 813, 253, -4.15, 3],
            [55, 1105, 53, 603, 501, -6.8, -14],
            [65, 797, 64, 729, 67, -6.65, 3],
            [91, 487, 76, 453, 33, -5.6, -23],
            1448 + 1579 + 1398 + 1352 + 1153 + 957,
            [105, 922, 92, 868, 53, -4.6, -3],
            [106, 19, 106, 6, 12, -4.2, 25],
            411 + 2917 + 1368 + 516 + 69 + 46 + 56 + 52,
            [127, 23, 96, 1, 21, -7, -6],
          ];
          break;
        case 0x2B:
          noteNumber = 30;
          parts = [
            1783 + 1067 + 1105 + 797 + 487 + 1448 + 1579 + 1398 + 1352 + 1153 + 957 + 922 + 19 + 411,
            [38, 2917, 29, 2415, 501, -4.29, -14],
            [54, 1368, 42, 1128, 239, -4, 4],
            [72, 516, 59, 425, 90, -3.3, 14],
            [87, 69, 64, 1, 67, -4, 3],
            [95, 46, 72, 3, 42, -7, -6],
            [102, 56, 80, 2, 53, -7, -3],
            [106, 52, 88, 1, 50, -7, -6],
            [127, 23, 96, 1, 21, -7, -6],
          ];
          break;
        case 0x2C:
          noteNumber = 31;
          parts = [
            6769,
            [55, 9962, 57, 251, 9710, -7.53, -7],
            [83, 11420, 71, 147, 11272, -7.53, -7],
            [127, 7548, 88, 136, 7411, -8.95, 8],
          ];
          break;
        case 0x2D:
          noteNumber = 24;
          parts = [
            1445 + 1424,
            [88, 2472, 71, 2073, 398, -1.54, -17],
            [127, 687, 96, 549, 137, -1.54, 1],
          ];
          break;
        case 0x2E:
          noteNumber = 26;
          parts = [
            2824 + 2562 + 1132 + 30,
            [62, 3842, 57, 3340, 501, -0.7, 0],
            [76, 3458, 70, 2937, 520, -0.7, -1],
            [86, 2760, 83, 2290, 469, 0, 1],
            [127, 2182, 96, 2033, 148, 2.7, 6],
          ];
          break;
        case 0x2F:
          noteNumber = 31;
          parts = [
            [50,  6769, 55, -1, -1,  0,   -44],
            [55, -6769, 55, -1, -1, -0.98, -44],
            [60, -6769, 55, -1, -1, -2.18, -44],
            [65, -6769, 55, -1, -1, -3.47, -44],
            [70, -6769, 55, -1, -1, -5.41, -44],
            [76, -6769, 55, -1, -1, -8.02, -44],
            [82, -6769, 55, -1, -1, -13.62, -44],
            [88, -6769, 55, -1, -1, -25.07, -44],
            [95, -6769, 55, -1, -1, -34.93, -44],
            [127, -6769, 55, -1, -1, -96, -44],
          ];
          break;
        case 0x30:
          // same as 2C bank 0 with +/- attenuation
          noteNumber = 31;
          switch (bank) {
            case 0x00:
              parts = [
                6769,
                [55, 9962, 57, 251, 9710, -5.04, -7],
                [83, 11420, 71, 147, 11272, -5.04, -7],
                [127, 7548, 88, 136, 7411, -6.47, 8],
              ];
              break;
            case 0x08:
              parts = [
                6769,
                [55, 9962, 57, 251, 9710, -6.58, -7],
                [83, 11420, 71, 147, 11272, -6.58, -7],
                [127, 7548, 88, 136, 7411, -8, 8],
              ];
              break;
          }
          break;
        case 0x31:
          // same as 2C bank 0 with +/- attenuation
          noteNumber = 31;
          parts = [
            6769,
            [55, 9962, 57, 251, 9710, -4.98, -7],
            [83, 11420, 71, 147, 11272, -4.98, -7],
            [127, 7548, 88, 136, 7411, -6.41, 8],
          ];
          break;
        case 0x37:
          noteNumber = 34;
          parts = [
            [127, 15392, 68, 13377, 2014, 0, -3],
          ];
          break;
        case 0x38:
          noteNumber = 38;
          parts = [
            4183 + 3503 + 3368 + 2874 + 1654 + 1180,
            [43, 2210, 40, 1941, 268, -2, 3],
            [50, 2894, 48, 2724, 169, -2, 4],
            [57, 2365, 55, 2251, 113, -2.5, 8],
            1993 + 2707 + 1602 + 951 + 474,
            [65, 1403, 53, 1275, 127, -2.8, 10],
            [73, 1291, 61, 1210, 80, -2.32, 10],
            [81, 1043, 69, 942, 100, -2.32, -4],
            [86, 760, 74, 721, 38, -2.32, 21],
            [93, 588, 80, 560, 27, -2.32, 29],
            [103, 461, 89, 444, 16, -2.3, 23],
            227,
            [127, 411, 95, 366, 44, -6.8, -25],
          ];
          break;
        case 0x39:
          noteNumber = 38;
          switch (bank) {
            case 0x00:
              // same as program 0x38 with +/- attenuation, key ranges
              parts = [
                4183 + 3503 + 3368 + 2874 + 1654 + 1180,
                [43, 2210, 40, 1941, 268, -3.48, 3],
                [50, 2894, 48, 2724, 169, -3.48, 4],
                [57, 2365, 55, 2251, 113, -4.04, 8],
                1993 + 2707 + 1602 + 951 + 474,
                [64, 1403, 53, 1275, 127, -4.91, 10],
                [72, 1291, 61, 1210, 80, -4.61, 10],
                [81, 1043, 69, 942, 100, -4.61, -4],
                [88, 760, 74, 721, 38, -5.66, 21],
                [93, 588, 80, 560, 27, -5.7, 29],
                [103, 461, 89, 444, 16, -4.6, 23],
                227,
                [127, 411, 95, 366, 44, -5.1, -25],
              ];
              break;
            case 0x01:
              parts = [
                4183 + 3503 + 3368 + 2874 + 1654 + 1180 + 2210,
                [43, 2894, 48, 2724, 169, 0, 4],
                [53, 2365, 55, 2251, 113, -0.04, 8],
                1993 + 2707 + 1602 + 951 + 474,
                [65, 1403, 53, 1275, 127, 0, 10],
                [73, 1291, 61, 1210, 80, 0, 10],
                [81, 1043, 69, 942, 100, 0, -4],
                [86, 760, 74, 721, 38, 0, 21],
                [93, 588, 80, 560, 27, 0, 29],
                [102, 461, 89, 444, 16, 0, 23],
                [127, 227, 99, 208, 18, -1, 27],
              ];
              break;
          }
          break;
        case 0x3A:
          noteNumber = 38;
          parts = [
            4183 + 3503 + 3368 + 2874,
            [39, 1654, 39, 1372, 281, -1, -15],
            [55, 1180, 50, 1032, 147, -1.1, -37],
            2210 + 2894 + 2365,
            [64, 1993, 62, 1916, 76, -1.4, 21],
            [72, 2707, 68, 2652, 54, -1.13, 29],
            [81, 1602, 77, 1569, 32, -1.13, 23],
            [88, 951, 86, 893, 57, -2.18, 21],
            [93, 474, 92, 460, 13, -2.2, -36],
            1403 + 1291 + 1043 + 760 + 588,
            [103, 461, 89, 444, 16, -2.8, 23],
            227,
            [127, 411, 95, 366, 44, -4.3, -25],
          ];
          break;
        case 0x3B:
          noteNumber = 38;
          parts = [
            [66, 4183, 64, 4115, 67, -5.5, 3],
            [74, 3503, 73, 3422, 80, -8.3, 10],
            [81, 3368, 79, 3254, 113, -6.47, 8],
            [87, 2874, 86, 2835, 38, -6.88, 21],
            1654 + 1180 + 2210 + 2894 + 2365 + 1993 + 2707 + 1602 + 951 + 474 + 1403 + 1291 + 1043 + 760,
            [93, 588, 80, 560, 27, -6.47, 29],
            [103, 460, 89, 444, 16, -6.5, 23],
            227,
            [127, 411, 95, 366, 44, -7.3, -25],
          ];
          break;
        case 0x3D:
          noteNumber = 32;
          switch (bank) {
            case 0x00: default:
              parts = [
                [68, 5872, 64, 5805, 66, -2.19, -23],
                [80, 7453, 72, 7241, 211, -1.3, 2],
                [90, 8189, 84, 7893, 295, -0.2, 0],
                [127, 5227, 96, 5183, 43, -3.2, 35],
              ];
              break;
            case 0x08:
              // bank 0 with +/- attenuation
              parts = [
                [68, 5872, 64, 5805, 66, -1.72, -23],
                [80, 7453, 72, 7241, 211, 0, 2],
                [90, 8189, 84, 7893, 295, 0, 0],
                [127, 5227, 96, 5183, 43, -2.74, 35],
              ];
              break;
          }
          break;
        case 0x40:
          noteNumber = 40;
          parts = [
            5466 + 3525 + 943 + 903 + 665 + 756 + 226 + 139 + 96 + 72 + 57,
            [70, 1952, 58, 1856, 95, -6.7, 7],
            [76, 1289, 64, 1220, 68, -3.3, 28],
            [82, 3810, 70, 3761, 48, -5.3, 25],
            [88, 3260, 76, 3225, 34, -5.3, 28],
            [95, 2303, 83, 2235, 67, -4.5, 1],
            [102, 475, 89, 458, 16, -3.6, 23],
            [127, 411, 95, 366, 44, -3.6, -25],
          ];
          break;
        case 0x41:
          noteNumber = 41;
          parts = [
            [53, 2611, 41, 2359, 251, -4.47, -11],
            [59, 1267, 47, 1086, 180, -3.37, 14],
            [63, 1256, 51, 1111, 144, -2, 27],
            [69, 1200, 57, 1098, 101, -1.5, 13],
            [77, 748, 65, 683, 64, -2.48, 23],
            [87, 1186, 75, 1150, 35, -2.19, -21],
            [96, 723, 83, 678, 44, -1.5, -25],
            [127, 355, 92, 302, 52, -1.5, -36],
          ];
          break;
        case 0x42:
          noteNumber = 41;
          parts = [
            2611 + 1267 + 1256 + 1200 + 748 + 1186 + 723 + 355 + 774 + 255 + 764 + 607 + 662 + 213 + 74 + 553 + 479 + 368,
            [43, 1582, 34, 1201, 380, -7.4, 7],
            [54, 1216, 45, 1014, 201, -6.7, 5],
            [60, 999, 51, 856, 142, -7.4, 3],
            [65, 833, 56, 726, 106, -6.7, -3],
            [71, 1013, 62, 936, 76, -5.68, 21],
            [78, 667, 69, 616, 50, -5.68, -4],
            [86, 580, 77, 547, 32, -5.68, 23],
            [94, 386, 85, 365, 20, -5.68, 10],
            [127, 415, 95, 403, 11, -5.68, -25],
          ];
          break;
        case 0x43:
          noteNumber = 41;
          parts = [
            2611 + 1267 + 1256 + 1200 + 748 + 1186 + 723 + 355 + 774 + 255,
            [40, 764, 38, 464, 299, -5.5, -8],
            [53, 607, 48, 438, 168, -5.5, -6],
            [71, 662, 59, 571, 90, -6.03, 14],
            [88, 213, 86, 193, 19, -5, 21],
            [95, 74, 109, 63, 10, -5, 10],
            553 + 479 + 368 + 1582 + 1216 + 999 + 833 + 1013 + 667 + 580 + 386,
            [127, 415, 95, 403, 11, -3, -25],
          ];
          break;
        case 0x44:
          noteNumber = 42;
          parts = [
            [64, 2246, 61, 2165, 80, -2.66, 10],
            [72, 1631, 69, 1579, 51, -2.66, 30],
            [79, 1612, 77, 1579, 32, -2.7, 23],
            [86, 906, 85, 825, 80, -2.7, 10],
            [102, 227, 81, 201, 25, -2.7, -4],
            [127, 227, 99, 208, 18, -3.5, 27],
          ];
          break;
        case 0x45:
          noteNumber = 40;
          parts = [
            5466 + 3525,
            [57, 943, 53, 815, 127, -3.65, 10],
            [65, 903, 61, 822, 80, -3.2, 10],
            [75, 665, 70, 616, 48, -8.1, 25],
            [85, 756, 82, 731, 24, -5, 25],
            226 + 139 + 96 + 72 + 57 + 1952 + 1289 + 3810 + 3260,
            [95, 2303, 83, 2235, 67, -3.65, 1],
            [102, 475, 89, 458, 16, -3.65, 23],
            [127, 411, 95, 366, 44, -5.7, -25],
          ];
          break;
        case 0x46:
          noteNumber = 41;
          parts = [
            2611 + 1267 + 1256 + 1200 + 748 + 1186 + 723 + 355,
            [50, 774, 44, 561, 212, -5.8, -3],
            [68, 255, 69, 205, 49, -2.98, -39],
            [86, -255, 69, 205, 49, -3.39, -39],
            764 + 607 + 662 + 213,
            [95, 74, 109, 63, 10, -3, 10],
            553 + 479 + 368 + 1582 + 1216 + 999 + 833 + 1013 + 667 + 580 + 386,
            [127, 415, 95, 403, 11, -4, -25],
          ];
          break;
        case 0x47:
          noteNumber = 40;
          parts = [
            5466 + 3525 + 943 + 903 + 665 + 756,
            [56, 226, 55, 113, 112, -6.28, -8],
            [70, 139, 64, 70, 68, -3.3, 28],
            [78, 96, 70, 48, 47, -3.3, -11],
            [85, 72, 75, 36, 35, -3.3, -21],
            [99, 57, 87, 38, 18, -7.5, 27],
            1952 + 1289 + 3810 + 3260 + 2303 + 475,
            [127, 411, 95, 366, 44, -3.3, -25],
          ];
          break;
        case 0x48:
          noteNumber = 43;
          parts = [
            1985 + 2029 + 1823 + 1296 + 1056 + 695 + 995 + 1071 + 757 + 323 + 207 + 5896 + 4854 + 4504,
            [82, 1198, 79, 1115, 82, -5.04, -49],
            [102, 690, 84, 668, 21, -5, -6],
            3125 + 2604,
            [127, 2892, 95, 2880, 11, -3.5, -25],
          ];
          break;
        case 0x49:
          noteNumber = 43;
          parts = [
            [69, 1985, 65, 1920, 64, -2.26, 23],
            [77, 2029, 73, 1948, 80, -2.26, 10],
            [84, 1823, 78, 1793, 29, -0.98, -47],
            [91, 1296, 88, 1261, 34, -2.71, 28],
            [97, 1056, 95, 1044, 11, -3.2, -25],
            [100, 695, 104, 681, 13, -6, -36],
            995 + 1071 + 757 + 323 + 207 + 5896 + 4854 + 4504 + 1198 + 690 + 3125 + 2604,
            [127, 2892, 95, 2880, 11, -3.8, -25],
          ];
          break;
        case 0x4A:
          noteNumber = 43;
          parts = [
            1985 + 2029 + 1823 + 1296 + 1056 + 695,
            [70, 995, 66, 934, 60, -5.8, -4],
            [77, 1071, 75, 1034, 36, -5.8, 11],
            [88, 757, 83, 733, 23, -5.8, 36],
            [95, 323, 93, 309, 13, -9.1, 48],
            [97, 207, 101, 190, 16, -7.2, 8],
            5896 + 4854 + 4504 + 1198 + 690 + 3125 + 2604,
            [127, 2892, 95, 2880, 11, -4.5, -25],
          ];
          break;
        case 0x4B:
          noteNumber = 42;
          parts = [
            2246 + 1631 + 1612 + 906 + 227 + 227 + 3661 + 2782 + 1826 + 1951 + 774 + 2026 + 1009,
            [58, 3846, 73, 1680, 2165, -2.5, 46],
            [97, -3846, 73, 1680, 2165, -4.4, 46],
            [127, 475, 89, 458, 16, -4.6, 23],
          ];
          break;
        case 0x4C:
          noteNumber = 42;
          parts = [
            2246 + 1631 + 1612 + 906 + 227 + 227 + 3661 + 2782 + 1826 + 1951 + 774,
            [81, 2026, 72, 1983, 42, -3.7, -6],
            [97, 1009, 84, 987, 21, -3.2, -6],
            3846,
            [127, 475, 89, 458, 16, -5.1, 23],
          ];
          break;
        case 0x4D:
          noteNumber = 43;
          parts = [
            1985 + 2029 + 1823 + 1296 + 1056 + 695 + 995 + 1071 + 757 + 323 + 207,
            [66, 5896, 63, 3559, 2336, -9.23, -2],
            [73, 4854, 70, 2962, 1891, -4.3, -1],
            [95, 4504, 78, 2509, 1994, -3.4, -2],
            1198,
            [102, 690, 84, 668, 21, -5.7, -6],
            3125 + 2604,
            [127, 2892, 95, 2880, 11, -6.7, -25],
          ];
          break;
        case 0x4E:
          noteNumber = 24;
          parts = [
            1445 + 1424 + 2472 + 687,
            [52, 234, 52, 100, 133, -2.42, -10],
            [64, 119, 64, 51, 67, -1.72, 3],
            [84, 60, 76, 25, 34, -1.7, 28],
            [98, 31, 88, 13, 17, -1.7, 28],
            30 + 27 + 43,
            [127, 2892, 95, 2880, 11, -3.6, -25],
          ];
          break;
        case 0x4F:
          noteNumber = 43;
          parts = [
            1985 + 2029 + 1823 + 1296 + 1056 + 695 + 995 + 1071 + 757 + 323 + 207 + 5896 + 4854 + 4504 + 1198 + 690,
            [81, 3125, 72, 3081, 43, -0.47, 35],
            [90, 2604, 83, 2581, 22, -1.45, -25],
            [127, 2892, 95, 2880, 11, -2.97, -25],
          ];
          break;
        case 0x51:
          switch (bank) {
            case 0x00:
            default:
              throw new Error('NYI');
            case 0x08:
              noteNumber = 40;
              parts = [
                [47, 5466, 53, 5339, 126, -4.24, -4],
                [72, -5466, 53, 5339, 126, -7.86, -4],
                [104, 3525, 77, 3461, 63, -3.5, -4],
                943 + 903 + 665 + 756 + 226 + 139 + 96 + 72 + 57 + 1952 + 1289 + 3810 + 3260 + 2303 + 475,
                [127, 411, 95, 366, 44, -7.2, -25],
              ];
              break;
          }
          break;
        case 0x53:
          noteNumber = 36;
          parts = [
            6268 + 5098 + 3197,
            [78, 5585, 72, 5542, 42, -2.14, -6],
            [127, 5936, 83, 5913, 22, -1.72, -25],
          ];
          break;
        case 0x54:
          noteNumber = 23;
          parts = [
            [52, 6133, 60, 5879, 253, -2.5, 1],
            [72, -6133, 60, 5879, 253, -4.7, 1],
            [101, 3232, 84, 3188, 43, -2.5, 35],
            3652 + 3282 + 2270 + 1805 + 940 + 1126 + 714 + 426,
            [127, 514, 97, 503, 10, -6.1, 10],
          ];
          break;
        case 0x56:
          noteNumber = 33;
          parts = [
            [63, 7678, 81, 4157, 3520, 0, 6],
            [105, -7678, 81, 4157, 3520, -1.5, 6],
            4754,
            [127, 3898, 91, 2237, 1660, -3.6, 1],
          ];
          break;
        case 0x58:
          noteNumber = 9;
          parts = [
            1630 + 636 + 375 + 249 + 98 + 1523 + 227 + 545 + 797 + 144 + 1085 + 595,
            [71, 5466, 53, 3820, 1645, -5.63, 4],
            [83, 3196, 81, 2374, 821, -3.5, -12],
            [99, -3196, 81, 2374, 821, -6.5, -12],
            1912 + 1603,
            [127, 315, 90, 299, 15, -8, 12],
          ];
          break;
        case 0x60:
          noteNumber = 33;
          parts = [
            7678,
            [78, 4754, 67, 2901, 1852, -2.4, -4],
            [90, 3898, 91, 2237, 1660, -1.7, 1],
            [127, -3898, 91, 2237, 1660, -2.42, 1],
          ];
          break;
        case 0x61:
          noteNumber = 35;
          parts = [
            [54, 11786, 60, 8409, 3376, 0, 2],
            [68, -11786, 60, 8409, 3376, -6.6, 2],
            [77, -11786, 60, 8409, 3376, -13, 2],
            [84, 9493, 84, 6590, 2902, -8.6, -3],
            [95, -9493, 84, 6590, 2902, -16, -3],
            [127, -9493, 84, 6590, 2902, -28.4, -3],
          ];
          break;
        case 0x62:
          switch (bank) {
            case 0x00: default:
              noteNumber = 9;
              parts = [
                [102, 1630, 88, 1428, 201, -1, 3],
                636 + 375 + 249 + 98 + 1523 + 227 + 545 + 797 + 144 + 1085 + 595 + 5466,
                [127, 3196, 81, 2374, 821, -4.1, -12],
              ];
              break;
            case 0x01:
              throw new Error('NYI');
          }
          break;
        case 0x63:
          noteNumber = 36;
          parts = [
            6268,
            [55, 5098, 60, 5013, 84, 0, -6],
            [79, -5098, 60, 5013, 84, -0.4, -6],
            [127, 3197, 84, 3175, 21, -0.4, -6],
          ];
          break;
        case 0x65:
          noteNumber = 36;
          parts = [
            [127, 6268, 84, 21, 6246, -10.35, 3],
          ];
          break;
        case 0x68:
          noteNumber = 41;
          switch (bank) {
            case 0x00:
            default:
              parts = [
                2611 + 1267 + 1256 + 1200 + 748 + 1186 + 723 + 355 + 774 + 255 + 764 + 607 + 662 + 213 + 74,
                [70, 553, 60, 469, 83, -5.98, -35],
                [81, 479, 76, 445, 33, -6.97, -31],
                [97, 368, 95, 345, 22, -6, -33],
                1582 + 1216 + 999 + 833 + 1013 + 667 + 580 + 386,
                [127, 415, 95, 403, 11, -7, -25],
              ];
              break;
            case 0x01:
              // bank 0x00 with +/- attenuation, fine tune
              parts = [
                2611 + 1267 + 1256 + 1200 + 748 + 1186 + 723 + 355 + 774 + 255 + 764 + 607 + 662 + 213 + 74,
                [70, 553, 60, 469, 83, -4.79, -27],
                [81, 479, 76, 445, 33, -5.78, -23],
                [97, 368, 95, 345, 22, -4.8, -25],
                1582 + 1216 + 999 + 833 + 1013 + 667 + 580 + 386,
                [127, 415, 95, 403, 11, -6, -25],
              ];
              break;
          }
          break;
        case 0x6C:
          noteNumber = 37;
          parts = [
            [103, 1495, 70, 1446, 48, -0.4, 25],
            3123,
            [127, 2182, 96, 2033, 148, -3.7, 6],
          ];
          break;
        case 0x6D:
          noteNumber = 42;
          parts = [
            2246 + 1631 + 1612 + 906 + 227 + 227,
            [57, 3661, 54, 3407, 253, -2.5, 1],
            [69, 2782, 65, 2513, 268, -2.5, 1],
            [80, 1826, 75, 1787, 38, -4, 19],
            [85, 1951, 85, 1781, 169, -4.3, 3],
            [92, 774, 94, 684, 89, -3.8, 24],
            2026 + 1009 + 3846,
            [127, 475, 89, 458, 16, -3.3, -75],
          ];
          break;
        case 0x72:
          noteNumber = 37;
          parts = [
            1495,
            [106, 3123, 83, 2661, 461, -4.6, -29],
            [127, 2182, 96, 2033, 148, -10, 6],
          ];
          break;
        case 0x74:
          switch (bank) {
            case 0x00: default:
              throw new Error('NYI');
            case 0x08:
              noteNumber = 31;
              parts = [
                [79,  6769, 55, -1, -1, -0.7,  -44],
                [84, -6769, 55, -1, -1, -1.68, -44],
                [89, -6769, 55, -1, -1, -2.88, -44],
                [94, -6769, 55, -1, -1, -4.17, -44],
                [99, -6769, 55, -1, -1, -6.11, -44],
                [105, -6769, 55, -1, -1, -8.72, -44],
                [111, -6769, 55, -1, -1, -14.31, -44],
                [117, -6769, 55, -1, -1, -25.77, -44],
                [124, -6769, 55, -1, -1, -35.63, -44],
                [127, -6769, 55, -1, -1, -3276.8, -44],
              ];
              break;
          }
          break;
        case 0x7D:
          switch (bank) {
            case 0x00: default:
            case 0x01:
            case 0x02:
            case 0x03:
            case 0x04:
            case 0x05:
            case 0x06:
            case 0x07:
            case 0x08:
              throw new Error('NYI');
            case 0x09:
              noteNumber = 37;
              parts = [
                1495 + 3123 + 2182,
                [127, 18202, 67, 553, 17648, -7.1, 1],
              ];
              break;
          }
          break;
      }
      return loadNoteData(noteNumber).then(function(samples) {
        var keys = new Array(128);
        var i = -1;
        function doKeys(toKey, len, unity, loopStart, loopLen, attenuation_dB, tune_cents) {
          var sliceBuffer;
          if (len < 0) {
            len = -len;
            sliceBuffer = audioContext.createBuffer(1, len, 22050);
            sliceBuffer.copyToChannel(new Float32Array(samples.buffer, samples.byteOffset - len * 4, len), 0);
          }
          else {
            sliceBuffer = audioContext.createBuffer(1, len, 22050);
            sliceBuffer.copyToChannel(samples.subarray(0, len), 0);
            samples = samples.subarray(len);
          }
          var playbackRateDenominator = noteFreq(unity);
          var gain = Math.pow(10, attenuation_dB / 20);
          for (; i <= toKey; i++) {
            var key = keys[i] = new Note(audioContext, sliceBuffer);
            key.note = i;
            key.unityNote = unity;
            if (loopLen !== -1) {
              key.loop = {start:loopStart, end:loopStart+loopLen};
            }
            key.detune = tune_cents;
            key.gain = gain;
          }
        }
        for (var j = 0; j < parts.length; j++) {
          if (typeof parts[j] === 'number') {
            samples = samples.subarray(parts[j]);
            continue;
          }
          doKeys.apply(null, parts[j]);
        }
        return keys;
      });
    },
  };
  
  var percussionMisc = [
    {len:641, attenuation:-11, finetune:45},
    {len:2864, finetune:0, attenuation:-5},
    {len:1516, finetune:0, attenuation:-6.6},
    {len:1828, finetune:0, attenuation:-5.8},
    {len:1558, finetune:0, attenuation:-0.7},
    {len:67, finetune:0, attenuation:-0.4},
    {len:880, finetune:2, attenuation:-1},
    {len:841, finetune:0, attenuation:-1.5},
    {len:5558, finetune:0, attenuation:-1.1},
    {len:3548, finetune:0, attenuation:0},
    {len:375, finetune:0, attenuation:0},
    {len:4892, finetune:-1, attenuation:-1.5},
    {len:7264, finetune:44, attenuation:0},
    {len:1579, finetune:0, attenuation:-2},
    {len:2005, finetune:0, attenuation:0},
    {len:6019, finetune:0, attenuation:0},
    {len:2254, finetune:0, attenuation:-10},
    {len:9121, finetune:0, attenuation:-8},
    {len:4916, finetune:0, attenuation:-0.5},
    {len:232, finetune:-20, attenuation:-5},
    {len:51, finetune:-23, attenuation:-5.8},
  ];
  percussionMisc.noteNumber = 501;
  
  note.getPercussion = function(audioContext, key, program) {
    var pack, index, override_finetune, override_attenuation;
    switch (key) {
      default: throw new Error('NYI');
      case 27:
        if (program === 0x30) throw new Error('NYI');
        pack = percussionMisc;
        index = 0;
        break;
      case 28:
        if (program === 0x30) throw new Error('NYI');
        pack = percussionMisc;
        index = 1;
        break;
      case 29:
        if (program === 0x30) throw new Error('NYI');
        pack = percussionMisc;
        index = 2;
        break;
      case 30:
        if (program === 0x30) throw new Error('NYI');
        pack = percussionMisc;
        index = 3;
        break;
      case 31:
        pack = percussionMisc;
        index = 4;
        break;
      case 32:
        pack = percussionMisc;
        index = 5;
        break;
      case 34:
        pack = percussionMisc;
        index = 6;
        break;
      case 36:
        if (program !== 0x10) throw new Error('NYI');
        pack = percussionMisc;
        index = 14;
        break;
      case 38:
        switch (program) {
          default: throw new Error('NYI');
          case 0x10:
            pack = percussionMisc;
            index = 15;
            break;
          case 0x19:
            pack = percussionMisc;
            index = 13;
            break;
          case 0x28:
            pack = percussionMisc;
            index = 16;
            break;
        }
        break;
      case 40:
        switch (program) {
          default: throw new Error('NYI');
          case 0x18:
            pack = percussionMisc;
            index = 15;
            break;
          case 0x28:
            pack = percussionMisc;
            index = 17;
            break;
        }
        break;
      case 42:
        switch (program) {
          default: throw new Error('NYI');
          case 0x19:
            pack = percussionMisc;
            index = 18;
            break;
        }
        break;
      case 44:
        switch (program) {
          default: throw new Error('NYI');
          case 0x19:
            pack = percussionMisc;
            index = 18;
            break;
        }
        break;
      case 46:
        switch (program) {
          default: throw new Error('NYI');
          case 0x19:
            pack = percussionMisc;
            index = 18;
            break;
        }
        break;
      case 56:
        switch (program) {
          default: throw new Error('NYI');
          case 0x19:
            pack = percussionMisc;
            index = 19;
            break;
        }
        break;
      case 62:
        switch (program) {
          default: throw new Error('NYI');
          case 0x19:
            pack = percussionMisc;
            index = 20;
            override_finetune = -23;
            override_attenuation = -1;
            break;
        }
        break;
      case 63:
        switch (program) {
          default: throw new Error('NYI');
          case 0x19:
            pack = percussionMisc;
            index = 20;
            override_finetune = -45;
            override_attenuation = -4.4;
            break;
        }
        break;
      case 64:
        switch (program) {
          default: throw new Error('NYI');
          case 0x19:
            pack = percussionMisc;
            index = 20;
            override_finetune = -58;
            override_attenuation = -2;
            break;
        }
        break;
      case 82:
        if (program === 0x38) throw new Error('NYI');
        pack = percussionMisc;
        index = 7;
        break;
      case 83:
        if (program === 0x38) throw new Error('NYI');
        pack = percussionMisc;
        index = 8;
        break;
      case 84:
        if (program === 0x38) throw new Error('NYI');
        pack = percussionMisc;
        index = 9;
        break;
      case 85:
        if (program === 0x38) throw new Error('NYI');
        pack = percussionMisc;
        index = 10;
        break;
      case 86:
      case 87:
        if (program === 0x38) throw new Error('NYI');
        pack = percussionMisc;
        index = 11;
        break;
      case 88:
        if (program !== 0x38) throw new Error('NYI');
        pack = percussionMisc;
        index = 12;
        break;
    }
    return loadNoteData(pack.noteNumber)
    .then(function(samples) {
      var offset = 0;
      for (var i = 0; i < index; i++) {
        offset += pack[i].len;
      }
      samples = samples.subarray(offset, offset + pack[index].len);
      var sliceBuffer = audioContext.createBuffer(1, samples.length, 22050);
      sliceBuffer.copyToChannel(samples, 0);
      var note = new Note(audioContext, sliceBuffer);
      note.detune = pack[i].finetune;
      note.gain = Math.pow(10, pack[i].attenuation / 20);
      return note;
    });
  };
  
  return note;
  
});
