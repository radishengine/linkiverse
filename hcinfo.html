<!DOCTYPE html>
<html>
<head>
  <title>HyperCard Tool</title>
  <style>
    pre { white-space: pre-wrap; }
    body:not(.show-code) .code { display: none; }
    body {
      font-family: sans-serif;
    }
    .loading {
      background: repeating-linear-gradient(-45deg,#ee8,#ee8 20px,#ccc 20px,#ccc 40px);
      background-size: 56px 56px;
      background-attachment: fixed;
      box-shadow: 15px 15px 10px rgba(0,0,0, 0.2) inset;
      cursor: progress;
      min-height: 1ex;
    }
    .loading .loading {
      box-shadow: none;
      background-image: none;
    }
    .error {
      background: #f88;
    }
  </style>
</head>
<body>
  <label>
    <input type='checkbox' onchange='document.body.className = this.checked ? "show-code" : ""'>
    Show code?
  </label>
  <div id='content'></div>
  <script>
    
function download(thing) {
  if (!(thing instanceof Blob)) {
    thing = new Blob([thing]);
  }
  var link = document.createElement('A');
  link.href = URL.createObjectURL(thing);
  link.setAttribute('download', 'file.dat');
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
    
var hcWorker = new Worker('hcworker.js');

function update() {

  'use strict';
  
  var name = location.hash.match(/^#\/?([a-zA-Z0-9_\-\.]+)\/?$/);
  name = name && name[1];
  if (!name) {
    document.getElementById('content').innerHTML = 'Please set URL #hash to a hypercard item ID';
    return;
  }
  
  document.getElementById('content').innerHTML = '';

  hcWorker.onmessage = function(e) {
    var message = e.data;
    console.log(message);
  };
  
  hcWorker.postMessage({
    headline: 'load',
    item: name,
  });
  
}
    
window.onhashchange = function() {
  update();
};
    
update();

  </script>
</body>
</html>
