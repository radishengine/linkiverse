<!DOCTYPE html>
<html>
<head>
  <script type='text/javascript'>
  
  function pullFile(item_id, filename) {
    return fetch('//cors.archive.org/cors/' + item_id + '/' + filename);
  }
  
  function readItemXML(xml) {
    if (typeof xml === 'string') {
      xml = new DOMParser().parseFromString(xml, 'application/xml');
    }
    var obj = {};
    for (var node = xml.documentElement.firstChild; node != null; node = node.nextSibling) {
      if (node.nodeType !== 1) continue;
      obj[node.nodeName] = node.textContent;
    }
    return obj;
  }
  
  function readFilesXML(xml) {
    if (typeof xml === 'string') {
      xml = new DOMParser().parseFromString(xml, 'application/xml');
    }
    var arr = [];
    for (var node = xml.documentElement.firstChild; node != null; node = node.nextSibling) {
      if (node.nodeName !== 'file') continue;
      var obj = {source: node.getAttribute('source')};
      for (var node2 = node.firstChild; node2 != null; node2 = node2.nextSibling) {
        obj[node2.nodeName] = node2.textContent;
      }
      arr.push(obj);
    }
    return arr;
  }
  
  function pullItem(item_id) {
    var p_item = pullFile(item_id, item_id + '_meta.xml')
      .then(function(response) { return response.text(); })
      .then(readItemXML);
    var p_files = pullFile(item_id, item_id + '_files.xml')
      .then(function(response) { return response.text(); })
      .then(readFilesXML);
    return Promise.all([p_item, p_files])
      .then(function(values) {
        var item = values[0], files = values[1];
        console.log(item);
        console.log(files);
      });
  }
  
  pullItem('adventuregamestudio');
  
  </script>
</head>
<body>
</body>
</html>
